# Steam Deck Optimization Summary

## Основные изменения для Steam Deck

### 1. Система скриншотов
- ✅ **Специализированная для Steam Deck**: Использует `spectacle` (встроенный в KDE Plasma)
- ✅ **Поиск окна игры**: Автоматически находит окно "Disco Elysium" через `xdotool`
- ✅ **Fallback система**: При отсутствии окна игры делает скриншот всего экрана
- ✅ **Удален сложный wrapper**: Убрана универсальная система с xwd/convert

### 2. Установка зависимостей
- ✅ **PyAutoGUI без evdev**: Установка с `--no-deps` для избежания проблем компиляции
- ✅ **Проверка Steam Deck инструментов**: Автоматическая проверка наличия `spectacle` и `xdotool`
- ✅ **Рекомендации по установке**: Команды `sudo pacman -S` для недостающих пакетов

### 3. LLM интеграция
- ✅ **Улучшенная диагностика**: Подробные сообщения об ошибках соединения с Ollama
- ✅ **Исправлен парсинг ответов**: Изменено с `response['message']['content']` на `response['response']`
- ✅ **Обработка таймаутов**: Более гибкая система обработки ошибок

### 4. Конфигурация
- ✅ **Единая конфигурация**: Все настройки в `config/config.yaml`
- ✅ **Удалена зависимость от .env**: Упрощенная система конфигурации
- ✅ **Портативная установка**: Все компоненты в venv/ директории

## Файлы изменены

### `install.sh`
- Переписана функция `create_image_tools()` для Steam Deck
- Добавлены проверки специфичных для Steam Deck инструментов
- Упрощена архитектура: теперь копирует готовые скрипты из `tools/`

### `tools/screenshot-tool`
- Специализированный скрипт для Steam Deck
- Использует spectacle + xdotool для захвата окна игры
- Fallback система для других инструментов

### `tools/image-convert`  
- Python-скрипт для конвертации изображений
- Заменяет ImageMagick convert
- Использует Pillow для обработки форматов

### `src/llm/agent.py` 
- Улучшена диагностика ошибок LLM
- Исправлен парсинг ответов от Ollama
- Добавлена обработка проблем соединения

### `src/vision/screen_analyzer.py`
- Упрощен вызов системы скриншотов
- Удалена сложная логика xwd/convert
- Добавлена передача названия окна

### `debug_system.sh`
- Увеличен таймаут с 5 до 10 секунд
- Добавлена проверка поиска окна игры
- Улучшены диагностические сообщения

## Команды для Steam Deck

```bash
# Установка недостающих инструментов
sudo pacman -S spectacle xdotool

# Полная установка системы
./install.sh

# Диагностика системы  
./debug_system.sh

# Запуск бота
./start.sh
```

## Проверка готовности

1. **Ollama**: Должен быть запущен и доступен на localhost:11434
2. **Spectacle**: Установлен в системе (обычно есть в KDE)
3. **Xdotool**: Установлен для поиска окон приложений
4. **Python 3.11+**: Установлен в venv/ через install.sh
5. **PyAutoGUI**: Установлен без evdev для избежания проблем

Система теперь полностью оптимизирована для Steam Deck и готова к использованию!